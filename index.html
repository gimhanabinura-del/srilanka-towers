<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SL Tower App Pro</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: #f4f4f4; }
        #map { height: 70vh; width: 100%; border-bottom: 3px solid #d32f2f; }
        
        /* Search Bar */
        .search-container {
            position: absolute; top: 10px; left: 10px; z-index: 1000;
            display: flex; width: calc(100% - 70px); max-width: 300px;
        }
        #searchInput {
            flex: 1; padding: 12px; border: none;
            border-radius: 8px 0 0 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #searchBtn {
            padding: 12px; background: #d32f2f; color: white;
            border: none; border-radius: 0 8px 8px 0; cursor: pointer;
        }

        /* Comment Box Section */
        .comment-section { padding: 20px; background: white; }
        .comment-header { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #333; }
        #commentInput {
            width: 100%; height: 80px; padding: 10px; 
            border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;
        }
        .post-btn {
            margin-top: 10px; padding: 10px 20px; background: #28a745;
            color: white; border: none; border-radius: 5px; cursor: pointer;
        }
        #commentList { margin-top: 20px; list-style: none; padding: 0; }
        .comment-item { 
            background: #f9f9f9; padding: 10px; border-radius: 5px; 
            margin-bottom: 10px; border-left: 4px solid #d32f2f;
        }

        /* Popup Style */
        .tower-name { color: #d32f2f; font-weight: bold; font-size: 15px; }
    </style>
</head>
<body>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="‡∂±‡∂ú‡∂ª‡∂∫ ‡∑É‡∂ª‡∑ä‡∂†‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±...">
        <button id="searchBtn">üîç</button>
    </div>

    <div id="map"></div>

    <div class="comment-section">
        <div class="comment-header">‡∂Ö‡∂Ø‡∑Ñ‡∑É‡∑ä ‡∑É‡∑Ñ ‡∂∫‡∑ù‡∂¢‡∂±‡∑è (Comments)</div>
        <textarea id="commentInput" placeholder="comments..."></textarea>
        <button class="post-btn" onclick="addComment()">Post Comment</button>
        
        <ul id="commentList">
            <li class="comment-item"><b>Admin:</b> ‡∑É‡∑è‡∂Ø‡∂ª‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∂±‡∑ä‡∂±‡∑Ä‡∑è!.</li>
        </ul>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. ‡∂∏‡∑ê‡∂¥‡∑ä ‡∂ë‡∂ö ‡∑É‡∂ö‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
        var myMap = L.map('map', { zoomControl: false }).setView([7.8731, 80.7718], 8);
        L.control.zoom({ position: 'bottomright' }).addTo(myMap);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(myMap);

        // 2. ‡∂ß‡∑Ä‡∂ª‡∑ä ‡∂á‡∂©‡∑ä ‡∂ö‡∂ª‡∂± Function ‡∂ë‡∂ö
        function addTower(lat, lng, name, cellId, bands) {
            L.marker([lat, lng]).addTo(myMap)
                .bindPopup(`
                    <div class="popup-card">
                        <span class="tower-name">${name}</span><br>
                        <b>Cell IDs:</b><br>${cellId}<br>
                        <b>Bands:</b> ${bands}
                    </div>
                `);
        }

        // ‡∂ß‡∑Ä‡∂ª‡∑ä ‡∂Ø‡∂≠‡∑ä‡∂≠ (‡∂∏‡∑ô‡∂≠‡∂±‡∂ß ‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä ‡∂í‡∑Ä‡∑è ‡∂á‡∂©‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±)
        addTower(6.9271, 79.8612, "Dialog Colombo", "54211, 54212", "B1, B3");
        addTower(7.2906, 80.6337, "Mobitel Kandy", "32101, 32102", "B1, B8");

        // 3. Search Function
        document.getElementById('searchBtn').onclick = function() {
            var city = document.getElementById('searchInput').value;
            if(city) {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}, Sri Lanka`)
                .then(res => res.json()).then(data => {
                    if(data.length > 0) myMap.setView([data[0].lat, data[0].lon], 14);
                });
            }
        };

        // 4. Comment Function
        function addComment() {
            var text = document.getElementById('commentInput').value;
            if(text) {
                var li = document.createElement('li');
                li.className = 'comment-item';
                li.innerHTML = `<b>User:</b> ${text}`;
                document.getElementById('commentList').prepend(li);
                document.getElementById('commentInput').value = '';
            }
        }

        // ‡∂∏‡∑ê‡∂¥‡∑ä ‡∂ë‡∂ö ‡∂ö‡∑ä‡∂Ω‡∑í‡∂ö‡∑ä ‡∂ö‡∑Ö‡∑è‡∂∏ ‡∂Ω‡∑ú‡∂ö‡∑ö‡∑Ç‡∂±‡∑ä ‡∂ë‡∂ö ‡∂∂‡∂Ω‡∑è‡∂ú‡∂±‡∑ä‡∂±
        myMap.on('click', function(e) {
            L.popup().setLatLng(e.latlng)
                .setContent("Lat: " + e.latlng.lat.toFixed(6) + "<br>Lng: " + e.latlng.lng.toFixed(6))
                .openOn(myMap);
        });
    </script>
</body>
</html>
