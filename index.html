<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SL Tower App</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #map { height: 100vh; width: 100%; }
        
        /* Search Bar Style */
        .search-container {
            position: absolute; top: 10px; left: 50px; z-index: 1000;
            width: 250px; display: flex;
        }
        #searchInput {
            width: 100%; padding: 10px; border: 1px solid #ccc;
            border-radius: 5px 0 0 5px; outline: none;
        }
        #searchBtn {
            padding: 10px; background: #d32f2f; color: white;
            border: none; cursor: pointer; border-radius: 0 5px 5px 0;
        }

        /* Popup Card Style */
        .popup-card { min-width: 180px; }
        .tower-name { color: #d32f2f; font-size: 16px; font-weight: bold; display: block; margin-bottom: 5px; border-bottom: 1px solid #eee; }
        .data-table { width: 100%; font-size: 13px; border-collapse: collapse; }
        .data-table td { padding: 4px 0; vertical-align: top; }
        .label { font-weight: bold; color: #555; width: 70px; }
    </style>
</head>
<body>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="නගරය සර්ච් කරන්න...">
        <button id="searchBtn">S</button>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. මැප් එක මුලින්ම පෙන්වන තැන
        var myMap = L.map('map', { zoomControl: false }).setView([7.8731, 80.7718], 8);
        L.control.zoom({ position: 'bottomright' }).addTo(myMap);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap'
        }).addTo(myMap);

        // 2. ටවර් එකක් ඇඩ් කරන ලස්සන Function එක
        function addTower(lat, lng, name, cellId, bands) {
            var marker = L.marker([lat, lng]).addTo(myMap);
            marker.bindPopup(`
                <div class="popup-card">
                    <span class="tower-name">${name}</span>
                    <table class="data-table">
                        <tr><td class="label">Cell IDs:</td><td>${cellId}</td></tr>
                        <tr><td class="label">Bands:</td><td>${bands}</td></tr>
                    </table>
                    <div style="font-size:10px; color:gray; margin-top:8px;">Loc: ${lat}, ${lng}</div>
                </div>
            `);
        }

        // --- මෙතනට ඔයාගේ දත්ත ඇතුළත් කරන්න ---
        // උදාහරණයක් ලෙස: (පේළි වෙන් කිරීමට <br> පාවිච්චි කරන්න)
        addTower(6.9271, 79.8612, "Dialog Colombo", "54211 (S1)<br>54212 (S2)<br>54213 (S3)", "B1, B3, B8");
        addTower(7.2906, 80.6337, "Mobitel Kandy", "32101, 32102", "B1, B3");

        // 3. Search Function එක
        document.getElementById('searchBtn').onclick = function() {
            var query = document.getElementById('searchInput').value;
            if(query) {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}, Sri Lanka`)
                .then(response => response.json())
                .then(data => {
                    if(data.length > 0) {
                        myMap.setView([data[0].lat, data[0].lon], 14);
                    } else {
                        alert("නගරය හමුවුනේ නැත!");
                    }
                });
            }
        };

        // 4. මැප් එක ක්ලික් කළාම ලොකේෂන් එක පෙන්වීම
        myMap.on('click', function(e) {
            var lat = e.latlng.lat.toFixed(6);
            var lng = e.latlng.lng.toFixed(6);
            L.popup().setLatLng(e.latlng)
                .setContent("<b>අලුත් ලොකේෂන් එක:</b><br>Lat: " + lat + "<br>Lng: " + lng)
                .openOn(myMap);
        });
    </script>
</body>
</html>
